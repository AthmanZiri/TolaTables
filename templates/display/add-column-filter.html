{% extends "base.html" %}
{% block page_title %}Tables{% endblock %}


{% block content %}
    <form action="/edit_filter/{{silo.id}}/" method="post">{% csrf_token %}
        <p>Show columns. This form allows you to pick which columns to hide</p>
        <br>
        <button id="checkall">Check All</button>
        <button id="uncheckall">Uncheck All</button>
        <br>
        <table id="listcolumns" class="table table-bordered table-hover table-striped">
          <tr>
              <th>Column Name</th>
              <th>Hide</th>
          </tr>
          {% for col in cols %}
              <tr>
                <td>{{col}}</td>
                <td align = "center"><input type="checkbox" name="columns" value="{{col}}"></td>
              <tr>
          {% endfor %}
        </table>
        <p>Show columns. This form allows you to pick under what condition to show a row</p>
        <button id="addcondition">Add Condition</button>
        <button id="addblankchar">Add Blank Character</button>
        <table id="listconditions" class="table table-bordered table-hover table-striped">
          <tr>
              <th>Operation</th>
              <th>Specifics</th>
          </tr>
        </table>
        <input type="submit" value="Submit" class="btn btn-sm btn-primary">
    </form>

    <!-- Modal -->
    <div id="add_condition_modal" class="modal fade modal-lg" role="dialog">
      <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Add a condition to filter rows</h4>
          </div>
          <div class="modal-body">
            <form id="conditionform">
              <p> Show only if </p>
              <select id="boolean">
                  <option value="OR">one of the following is</option>
                  <option value="AND">all of the following are</option>
              </select>
              <select id="math">
                  <option value="gt">&gt;</option>
                  <option value="lt">&lt;</option>
                  <option value="gte">&ge;</option>
                  <option value="lte">&le;</option>
                  <option value="empty">empty</option>
                  <option value="nempty">not empty</option>
              </select>
              <br>
              <button id="checkall_condition">Check All</button>
              <button id="uncheckall_condition">Uncheck All</button>
              <br>
              <table id="listcolumns_conditions" class="table table-bordered table-hover table-striped">
                <tr>
                    <th>Column Name</th>
                    <th>Hide</th>
                </tr>
                {% for col in cols %}
                    <tr>
                      <td>{{col}}</td>
                      <td align = "center"><input type="checkbox" name="columns" value="{{col}}"></td>
                    <tr>
                {% endfor %}
              </table>
              <input type="submit" value="Submit" class="btn btn-sm btn-primary">
            </form>
          </div>
        </div>
      </div>
    </div>
    <!-- Modal -->
    <div id="add_blankchar_modal" class="modal fade modal-lg" role="dialog">
      <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Add a blank character</h4>
          </div>
          <div class="modal-body">
            <form id="blankcharform">
              <p> The filter will read this word as blank: </p>
              <input type="text" id="new_blank_char" class="form-control"><br>
              <input type="submit" value="Submit" class="btn btn-sm btn-primary">
            </form>
          </div>
        </div>
      </div>
    </div>

{% endblock content %}

{% block extra_js_in_body %}
    <script type="text/javascript">
        $(document).ready(function() {
            $("#addcondition").on('click', function(e){
                e.preventDefault();
                $("#add_condition_modal").modal();
            });
            $("#addblankchar").on('click', function(e){
                e.preventDefault();
                $("#add_blankchar_modal").modal();
            });
            $("#checkall").on('click', function(e){
                e.preventDefault();
                $("#listcolumns").find('td input:checkbox').each(function() {
                    this.checked = true;
                });
            });
            $("#uncheckall").on('click', function(e){
                e.preventDefault();
                $("#listcolumns").find('td input:checkbox').each(function() {
                    this.checked = false;
                });
            });
            $("#checkall_condition").on('click', function(e){
                e.preventDefault();
                $("#listcolumns_conditions").find('td input:checkbox').each(function() {
                    this.checked = true;
                });
            });
            $("#uncheckall_condition").on('click', function(e){
                e.preventDefault();
                $("#listcolumns_conditions").find('td input:checkbox').each(function() {
                    this.checked = false;
                });
            });
            $("#blankcharform").submit(function(e){
                e.preventDefault();
                $("#add_blankchar_modal").modal('toggle');
                var table = document.getElementById('listconditions').getElementsByTagName('tbody')[0];
                var newRow = table.insertRow(table.rows.length);
                var newCell = newRow.insertCell(0);
                var newText = document.createTextNode('Additional blank');
                newCell.appendChild(newText);
                newCell = newRow.insertCell(1);
                newText = document.createTextNode($("#new_blank_char").val());
                document.createTextNode($("#new_blank_char").val(""));
                newCell.appendChild(newText);

            });
            $("#conditionform").submit(function(e){
                e.preventDefault();
                $("#add_condition_modal").modal('toggle');
                var table = document.getElementById('listconditions').getElementsByTagName('tbody')[0];
                var newRow = table.insertRow(table.rows.length);
                var newCell = newRow.insertCell(0);
                var newText = document.createTextNode($("#boolean").val()+" "+$("#math").val());
                newCell.appendChild(newText);
                newCell = newRow.insertCell(1);
                var text = "";
                $("#listcolumns_conditions").find('td input:checkbox').each(function() {
                  if (this.checked) {
                    text += this.value + ",";
                  }
                });
                newText = document.createTextNode(text);
                newCell.appendChild(newText);
            });
        });

    </script>


{% endblock extra_js_in_body %}
